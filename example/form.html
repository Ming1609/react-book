<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title></title>
<script src="../static/es5-shim.min.js"></script>
<script src="../static/es5-sham.min.js"></script>
<script src="../static/console-polyfill.js"></script>
<script src="../static/classnames.js"></script>
<script src="../static/react.js"></script>
<script src="../static/react-dom.js"></script>
<script src="../static/JSXTransformer.js"></script>
<style>
script[type="text/jsx"] {
    border:1px solid #ddd;
    padding-left: 5px;
    padding-right: 5px;
    padding-bottom: 5px;
    display: block;
    font-family: monospace;
    white-space: pre;
    margin: 1em 0px 1em;
}
.ui-input-error-box {
    display: none;
    color:red;
}
.ui-input-error .ui-input-error-box {
    display: block;
}
</style>
<script type="text/jsx">
var Input = React.createClass({
    statics: {
        addRule: function (name, rule, msg) {
            var self = this
            if (self._ruleMap[name]) {
                throw name + "已存在"
            }
            self._ruleMap[name] = [rule, msg]
        },
        getRule: function (name) {
            var self = this
            var rule = self._ruleMap[name]
            if (typeof rule === 'object') {
                return {
                    verify: rule[0],
                    msg: rule[1]
                }
            }
            else {
                return false
            }
        },
        _ruleMap: {
            required: [
                /\S/
            ],
            minlength: [
                function (value) {
                    var self = this
                    return value.length >= self.props.minlength
                }
            ],
            maxlength: [
                function (value) {
                    var self = this
                    return value.length <= self.props.maxlength
                }
            ],
            email: [
                /^\s*([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,20})\s*$/
            ],
            urlstrict: [
                    /^(?:(?:ht|f)tp(?:s?)\:\/\/|~\/|\/)?(?:\w+:\w+@)?((?:(?:[-\w\d{1-3}]+\.)+(?:com|org|net|gov|mil|biz|info|mobi|name|aero|jobs|edu|co\.uk|ac\.uk|it|fr|tv|museum|asia|local|travel|[a-z]{2}))|((\b25[0-5]\b|\b[2][0-4][0-9]\b|\b[0-1]?[0-9]?[0-9]\b)(\.(\b25[0-5]\b|\b[2][0-4][0-9]\b|\b[0-1]?[0-9]?[0-9]\b)){3}))(?::[\d]{1,5})?(?:(?:(?:\/(?:[-\w~!$+|.,=]|%[a-f\d]{2})+)+|\/)+|\?|#)?(?:(?:\?(?:[-\w~!$+|.,*:]|%[a-f\d{2}])+=?(?:[-\w~!$+|.,*:=]|%[a-f\d]{2})*)(?:&(?:[-\w~!$+|.,*:]|%[a-f\d{2}])+=?(?:[-\w~!$+|.,*:=]|%[a-f\d]{2})*)*)*(?:#(?:[-\w~!$ |\/.,*:;=]|%[a-f\d]{2})*)?$/i
            ],
            url: [
                /^[^.]+\.[a-z]{2}$/
            ],
            number: [/^[+-]?[1-9][0-9]*(\.[0-9]+)?([eE][+-][1-9][0-9]*)?$|^[+-]?0?\.[0-9]+([eE][+-][1-9][0-9]*)?$|^0$/],
            min: [function (value) {
                var self = this
                return Number(value) >= Number(self.props.min);
            }],
            max: [function (value) {
                var self = this
                return Number(value) <= Number(self.props.max);
            }],
            date: [/^\d{4}\-[01]?\d\-[0-3]?\d$|^[01]\d\/[0-3]\d\/\d{4}$|^\d{4}年[01]?\d月[0-3]?\d[日号]$/],
            mobile: [
                /^1\d{10}$/
            ]
        }
    },
    getDefaultProps: function () {
        return {
            type: 'text',
            className: '',
            errorMsg: '{{display}}的格式不正确',
            required: false,
            requiredMsg: '请输入{{display}}',
            minlength: false,
            maxlength: false,
            maxlengthMsg: '{{display}}的长度必须小于或等于 {{maxlength}}',
            minlengthMsg: '{{display}}的长度必须大于或等于 {{minlength}}',
            minMsg: '{{display}}必须大于或者等于{{min}}',
            maxMsg: '{{display}}必须小于或者等于{{max}}',
            confirmationMsg: '请再重复输入一遍{{display}}',
            rule: false
        }
    },
    getInitialState: function () {
        return {
            // Boolean || String
            error: false
        }
    },
    onBlur: function () {
        var self = this
        self.setState({
            error: self.verify()
        })
    },
    verify: function () {
        var self = this
        var statics = self.constructor
        var error = ''
        var value = self.refs.input.value
        var check = function (rule) {
            var result
            switch (typeof rule.verify) {
                // regexp
                case 'object':
                result = rule.verify.test(value)
                break
                case 'function':
                result = rule.verify.call(self, value)
                break
            }
            return result
        }
        if (self.props.required) {
            if (!check(statics.getRule('required'))) {
                error = self.props.requiredMsg
            }
        }
        if (self.props.minlength) {
            if (!check(statics.getRule('minlength'))) {
                error = self.props.minlengthMsg
            }
        }
        if (self.props.maxlength) {
            if (!check(statics.getRule('maxlength'))) {
                error = self.props.maxlengthMsg
            }
        }
        if (self.props.min) {
            if (!check(statics.getRule('min'))) {
                error = self.props.minMsg
            }
        }
        if (self.props.max) {
            if (!check(statics.getRule('max'))) {
                error = self.props.maxMsg
            }
        }
        // 之前没有验证出错 && 内容为空
        if (!error && /\S/.test(value)) {
            // type="email"
            ;(function () {
                var typeRule = statics.getRule(self.props.type)
                if (typeRule) {
                    if (!check(typeRule)) {
                        error = self.props.errorMsg
                    }
                }
            })();
        }
        
        if (error !== '') {
            error = error.replace(/\{\{([^}]+)\}\}/g, function () {
                var variable = arguments[1]
                return self.props[variable]
            })
            return error
        }
    },
    render: function () {
        var self = this
        var wrapClass = classNames(self.props.className, {
            'ui-input': true,
            'ui-input-error': self.state.error
        })
        return (
            <span className={wrapClass}>
                <input type={self.props.type} ref="input" onBlur={self.onBlur} />
                <span className="ui-input-error-box">{self.state.error}</span>
            </span>
        )
    }
})
</script>
</head>
<body>

<h2>必填</h2>
<div id="Required"></div>
<script type="text/jsx" class="showcode">
ReactDOM.render(
    <Input type="text" required display="用户名"  />
    , document.getElementById('Required')
    )
</script>

配置必填错误提示
<div id="RequiredMsg"></div>
<script type="text/jsx" class="showcode">
ReactDOM.render(
    <Input type="text" required requiredMsg="{{display}}必填" display="邮箱"  />
    , document.getElementById('RequiredMsg')
    )
</script>
<hr>

<h2>minlength 最小字数</h2>
<div id="MinLength"></div>
<script type="text/jsx" class="showcode">
ReactDOM.render(
    <Input type="password" minlength={4} display="密码"  />
    , document.getElementById('MinLength')
    )
</script>
<hr>

<h2>maxlength 最大字数</h2>
<div id="MaxLength"></div>
<script type="text/jsx" class="showcode">
ReactDOM.render(
    <Input type="password" maxlength={4} display="密码"  />
    , document.getElementById('MaxLength')
    )
</script>
<hr>


<h2>minlength 和 maxlength 的组合</h2>
只能输入 2 ~ 4 位
<div id="MinLengthMaxLength"></div>
<script type="text/jsx" class="showcode">
ReactDOM.render(
    <Input type="password" minlength={2} maxlength={4} display="密码"  />
    , document.getElementById('MinLengthMaxLength')
    )
</script>
<hr>

<h2>type="email"</h2>
没有 required 时候可以不填，填了以后才会校验 email 格式是否正确
<div id="TypeEmail"></div>
<script type="text/jsx" class="showcode">
ReactDOM.render(
    <Input type="email" display="邮箱"  />
    , document.getElementById('TypeEmail')
    )
</script>

<h2>type="email"</h2>
配置 required 后必须填内容，并格式符合 email
<div id="TypeEmailRequired"></div>
<script type="text/jsx" class="showcode">
ReactDOM.render(
    <Input type="email" required display="邮箱"  />
    , document.getElementById('TypeEmailRequired')
    )
</script>
<hr>

<h2>type="url"</h2>
<strong>不</strong>带 http:// https:// 前缀的 url
<div id="TypeUrl"></div>
<script type="text/jsx" class="showcode">
ReactDOM.render(
    <div>
    <select>
        <option value="http://">http://</option>
        <option value="https://">https://</option>
    </select>
    <Input type="url" required display="网址"  />
    </div>
    , document.getElementById('TypeUrl')
    )
</script>
<hr>

<h2>type="urlstrict"</h2>
带 http:// https:// 前缀的 url
<div id="TypeUrlstrict"></div>
<script type="text/jsx" class="showcode">
ReactDOM.render(
    <Input type="urlstrict" required display="网址"  />
    , document.getElementById('TypeUrlstrict')
    )
</script>
<hr>

<h2>number</h2>
<div id="Number"></div>
<script type="text/jsx" class="showcode">
ReactDOM.render(
    <Input type="number"  display="数量"  />
    , document.getElementById('Number')
    )
</script>
<hr>

<h2>min</h2>
<div id="Min"></div>
<script type="text/jsx" class="showcode">
ReactDOM.render(
    <Input type="number" min={2}  display="数量"  />
    , document.getElementById('Min')
    )
</script>
<hr>

<h2>max</h2>
<div id="Max"></div>
<script type="text/jsx" class="showcode">
ReactDOM.render(
    <Input type="number" max={2}  display="数量"  />
    , document.getElementById('Max')
    )
</script>
<hr>

<h2>min 和 max 的组合</h2>
只能选择 2 ~ 5
<div id="MinMax"></div>
<script type="text/jsx" class="showcode">
ReactDOM.render(
    <Input type="number" min={2} max={5}  display="数量"  />
    , document.getElementById('MinMax')
    )
</script>
<hr>

<!-- <h2>rule regexp</h2>
<div id="RuleRegexp"></div>
<script type="text/jsx" class="showcode">
Input.addRule('some', /abc/, '{{display}} 必须存在 abc')
ReactDOM.render(
    <Input type="email" rule="some" display="邮箱"  />
    , document.getElementById('RuleRegexp')
    )
</script>
<hr>


<h2>rule function</h2>
<div id="RuleFn"></div>
<script type="text/jsx" class="showcode">
Input.addRule('fn', function (value) {
    return /123/.test(value)
}, '{{display}} 必须存在 123')
ReactDOM.render(
    <Input type="email" rule="fn" display="邮箱"  />
    , document.getElementById('RuleFn')
    )
</script>
<hr>

<h2>async</h2>
<div id="Async"></div>
<script type="text/jsx" class="showcode">
function checkcode (value, cb) {
    setTimeout(function () {
        cb({
            error: true,
            msg: '错误原因'
        })
        // cb({
        //     error: false
        // })
    })
}
ReactDOM.render(
    <Input type="email" async={checkcode} display="邮箱"  />
    , document.getElementById('Async')
    )
</script>
<hr> -->








</body>
</html>